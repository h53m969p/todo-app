<!DOCTYPE html>
<html xmlns:th="http://www.thmeleaf.org">
<head>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.0/font/bootstrap-icons.css">
	<title>Dashboard | ToDo</title>
</head>
<style>
	body {
			background-color: #f8f9fa;
		}
		.header {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin: 1rem 0;
		}
		.search-form {
			display: flex;
			width: 100%;
		}
		.filter-group {
			display: flex;
			align-items: center;
			margin-bottom: 1rem;
		}
		.filter-group .form-group {
			margin-right: 1rem;
		}
		.table {
			width: 100%;
			margin-top: 1rem;
		}
		 .rounded-semi {
            border-radius: 50px 50px 0 0;
        }
        .task-link {
		color: #343a40; /* Bootstrapの黒色 */
		}
		.task-link:hover {
			color: #212529; /* リンクのホバー時の色を指定 */
		}
</style>
<body>
	<div class="container">
		<div class="header">
		<form class="search-form" th:action="@{/tasks/search}" method="get">
			<input class="form-control" type="search" name="name" placeholder="search tasks..." required style="border-radius: 50px;">
			<button class="btn btn-outline-secondary ml-2" type="submit" style="border-radius: 50px;"><i class="bi bi-search"></i></button>
		</form>
		<form name="logoutform" th:action="@{/logout}" method="post">
			<button type="submit" class="btn btn-outline-primary" style="border-radius: 50px;">sign out</button>
		</form>
	</div>
		
	<form th:action="@{/tasks}" method="get" class="filter-group">
        <div class="form-group">
            <label for="priority">Priority:</label>
            <select class="form-control" id="priority" name="priority" onchange="this.form.submit()" style="border-radius: 50px;">
                <option th:text="'All'" th:selected="${selectedPriority == 'All'}">All</option>
                <option th:each="priority : ${priorities}" th:value="${priority.priority}" th:text="${priority.priority}" th:selected="${selectedPriority == priority.priority}"></option>
            </select>
        </div>
        <div class="form-group">
            <label for="category">Category:</label>
            <select class="form-control" id="category" name="category" onchange="this.form.submit()" style="border-radius: 50px;">
                <option th:text="'All'" th:selected="${selectedCategory == 'All'}">All</option>
                <option th:each="category : ${categories}" th:value="${category.category}" th:text="${category.category}" th:selected="${selectedCategory == category.category}"></option>
            </select>
        </div>
        <a th:href="@{/tasks/create}" class="btn btn-outline-primary ml-auto" style="border-radius: 50px;">Add New Task</a>
    </form>
	
	<table class="table table-bordered">
		<thead>
			<tr>
				<th scope="col" style="width: 5%;"></th>
				<th scope="col" style="width: 5%;"></th>
				<th scope="col" style="width: 15%;">タスク名</th>
				<th scope="col" style="width: 10%;">期限</th>
				<th scope="col" style="width: 10%;">優先度</th>
				<th scope="col" style="width: 10%;">カテゴリー</th>
				<th scope="col" style="width: 45%;">説明</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="task : ${tasks}">
				<td>
	    			<form th:action="@{tasks/delete}" method="post">
	        			<input type="hidden" name="taskId" th:value="${task.id}" />
	        			<button class="btn btn-outline-secondary" style="border-radius: 50px;" type="submit"><i class="bi bi-trash3-fill"></i></button>
	    			</form>
			    </td>
				<td>
					<form th:action="@{/tasks/toggleTaskStatus}" method="post">
						<input type="hidden" name="taskId" th:value="${task.id}" />
						<div class="status-container">
							<button type="submit" class="border-0 bg-transparent p-0 m-0">
								<span class="badge rounded-pill badge-padding pointer-cursor" 
									  style="padding: 5px 10px; cursor: pointer;"
									  th:classappend="${task.completed} ? 'badge-primary' : 'badge-warning'"
									  th:text="${task.completed} ? 'Complete' : 'Incomplete'"></span>
							</button>
						</div>
					</form>
	            </td>
              	<td><a th:href="@{/tasks/edit/{id}(id=${task.id})}" th:text="${task.name}" class="task-link"></a></td>
				<td th:text="${task.dueDate}"></td>
				<td th:text="${task.priority}"></td>
				<td th:text="${task.category}"></td>
				<td th:text="${task.description}"></td>
			</tr>
			</tbody>
		</table>
	</div>
</body>
</html>